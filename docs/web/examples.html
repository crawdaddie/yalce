<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YLC Documentation</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="top-bar">
      <div class="top-bar-content">
        <h1><a href="index.html">ðŸ¦” YLC</a></h1>
        <nav>
          <a href="repl.html">
            <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
              <path d="M2 3.75C2 2.784 2.784 2 3.75 2h8.5c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25Zm1.75-.25a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-8.5a.25.25 0 0 0-.25-.25ZM5 6.5h6v1H5Zm0 3h6v1H5Z"/>
            </svg>
            REPL
          </a>
          <a href="https://github.com/crawdaddie/yalce" target="_blank" rel="noopener noreferrer">
            <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
            </svg>
            GitHub
          </a>
        </nav>
      </div>
    </header>
    <main class="content">
      <h2 id="linear-regression-example">Linear Regression Example</h2>
<div class="codehilite"><pre><span></span><code><span class="o">#!</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">env</span> <span class="n">ylc</span> <span class="o">-</span><span class="n">i</span>
<span class="n">import</span> <span class="n">std</span><span class="o">/</span><span class="nc">Math</span><span class="o">;</span>
<span class="n">import</span> <span class="n">std</span><span class="o">/</span><span class="nc">Arrays</span><span class="o">;</span>


<span class="k">let</span> <span class="nc">X</span> <span class="o">=</span> <span class="n">array_fill</span> <span class="mi">100</span> <span class="o">(</span><span class="n">fn</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="nn">Math</span><span class="p">.</span><span class="n">rand_double_range</span> <span class="mi">0</span><span class="o">.</span> <span class="mi">10</span><span class="o">.);</span>
<span class="k">let</span> <span class="nc">Y</span> <span class="o">=</span> <span class="n">array_fill</span> <span class="mi">100</span> <span class="o">(</span><span class="n">fn</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="mi">2</span><span class="o">.</span> <span class="o">*</span> <span class="nc">X</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="nn">Math</span><span class="p">.</span><span class="n">rand_double</span> <span class="bp">()</span><span class="o">);</span>

<span class="k">let</span> <span class="n">forward</span> <span class="o">=</span> <span class="n">fn</span> <span class="o">(</span><span class="n">pw</span><span class="o">,</span> <span class="n">pb</span><span class="o">)</span> <span class="n">x</span> <span class="o">-&gt;</span> 
  <span class="k">let</span> <span class="n">out_feat</span> <span class="o">=</span> <span class="n">array_size</span> <span class="n">pb</span><span class="o">;</span>
  <span class="k">let</span> <span class="n">out</span> <span class="o">=</span> <span class="n">array_fill_const</span> <span class="o">(</span><span class="n">out_feat</span> <span class="o">*</span> <span class="o">(</span><span class="n">array_size</span> <span class="n">x</span><span class="o">))</span> <span class="mi">0</span><span class="o">.;</span>

  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="o">(</span><span class="n">array_size</span> <span class="n">out</span><span class="o">)</span> <span class="k">in</span> <span class="o">(</span>
    <span class="n">out</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">:=</span> <span class="n">pb</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="n">pw</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
  <span class="o">);</span>
  <span class="n">out</span>
  <span class="o">;;</span>

<span class="k">type</span> <span class="nc">TLinear</span> <span class="o">=</span> <span class="o">(</span>
  <span class="n">weight</span><span class="o">:</span> <span class="nc">Array</span> <span class="k">of</span> <span class="nc">Double</span><span class="o">,</span>
  <span class="n">bias</span><span class="o">:</span> <span class="nc">Array</span> <span class="k">of</span> <span class="nc">Double</span>
<span class="o">);</span>

<span class="k">let</span> <span class="nc">Linear</span> <span class="o">=</span> <span class="n">fn</span> <span class="n">in_feat</span> <span class="n">out_feat</span> <span class="o">-&gt;</span>
  <span class="o">(</span>
    <span class="n">weight</span><span class="o">:</span> <span class="n">array_fill</span> <span class="o">(</span><span class="n">in_feat</span> <span class="o">*</span> <span class="n">out_feat</span><span class="o">)</span> <span class="nn">Math</span><span class="p">.</span><span class="n">rand_double</span><span class="o">,</span>
    <span class="n">bias</span><span class="o">:</span>   <span class="n">array_fill</span> <span class="n">out_feat</span>             <span class="nn">Math</span><span class="p">.</span><span class="n">rand_double</span><span class="o">,</span>
  <span class="o">)</span>
<span class="o">;;</span>

<span class="k">let</span> <span class="n">mse_loss</span> <span class="o">=</span> <span class="n">fn</span> <span class="n">prediction</span> <span class="n">y</span> <span class="o">-&gt;</span>
  <span class="k">let</span> <span class="n">aux_rec</span> <span class="o">=</span> <span class="n">fn</span> <span class="n">i</span> <span class="n">res</span> <span class="n">y</span> <span class="n">p</span> <span class="o">-&gt;</span>
    <span class="k">match</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">array_size</span> <span class="n">p</span> <span class="k">with</span>
    <span class="o">|</span> <span class="bp">true</span> <span class="o">-&gt;</span> <span class="n">res</span>
    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="o">(</span>
      <span class="k">let</span> <span class="n">pred_val</span> <span class="o">=</span> <span class="n">p</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="k">in</span>
      <span class="k">let</span> <span class="n">target_val</span> <span class="o">=</span> <span class="n">y</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="k">in</span>
      <span class="k">let</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">pred_val</span> <span class="o">-</span> <span class="n">target_val</span> <span class="k">in</span>
      <span class="k">let</span> <span class="n">squared_diff</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">diff</span> <span class="k">in</span>
      <span class="k">let</span> <span class="n">new_res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="n">squared_diff</span> <span class="k">in</span>
      <span class="n">aux_rec</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">new_res</span> <span class="n">y</span> <span class="n">p</span>
    <span class="o">)</span>
  <span class="o">;;</span>
  <span class="k">let</span> <span class="n">total_error</span> <span class="o">=</span> <span class="n">aux_rec</span> <span class="mi">0</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span> <span class="n">y</span> <span class="n">prediction</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">count</span> <span class="o">=</span> <span class="n">array_size</span> <span class="n">prediction</span> <span class="k">in</span>
  <span class="n">total_error</span> <span class="o">/</span> <span class="n">count</span>
<span class="o">;;</span>

<span class="k">let</span> <span class="n">sgd_optim</span> <span class="o">=</span> <span class="n">fn</span> <span class="n">learning_rate</span> <span class="n">model</span><span class="o">:</span> <span class="o">(</span><span class="nc">TLinear</span><span class="o">)</span> <span class="n">pred</span> <span class="nc">X</span> <span class="n">y</span> <span class="o">-&gt;</span>
  <span class="k">let</span> <span class="n">n</span> <span class="o">=</span> <span class="n">array_size</span> <span class="n">pred</span><span class="o">;</span>

  <span class="k">let</span> <span class="n">grad_weight</span> <span class="o">=</span> <span class="o">[|</span> <span class="mi">0</span><span class="o">.</span> <span class="o">|];</span>
  <span class="k">let</span> <span class="n">grad_bias</span> <span class="o">=</span> <span class="o">[|</span> <span class="mi">0</span><span class="o">.</span> <span class="o">|];</span>

  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">n</span> <span class="k">in</span> <span class="o">(</span>
    <span class="k">let</span> <span class="n">error</span> <span class="o">=</span> <span class="n">pred</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">-</span> <span class="n">y</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
    <span class="k">let</span> <span class="n">x_i</span> <span class="o">=</span> <span class="nc">X</span><span class="o">[</span><span class="n">i</span><span class="o">];</span> 

    <span class="n">grad_weight</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">:=</span> <span class="n">grad_weight</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="o">(</span><span class="mi">2</span><span class="o">.</span> <span class="o">*</span> <span class="n">error</span> <span class="o">*</span> <span class="n">x_i</span> <span class="o">/</span> <span class="n">n</span><span class="o">);</span>

    <span class="n">grad_bias</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">:=</span> <span class="n">grad_bias</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="o">(</span><span class="mi">2</span><span class="o">.</span> <span class="o">*</span> <span class="n">error</span> <span class="o">/</span> <span class="n">n</span><span class="o">)</span>
  <span class="o">);</span>

  <span class="n">model</span><span class="o">.</span><span class="n">weight</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">:=</span> <span class="n">model</span><span class="o">.</span><span class="n">weight</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">-</span> <span class="n">learning_rate</span> <span class="o">*</span> <span class="n">grad_weight</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
  <span class="n">model</span><span class="o">.</span><span class="n">bias</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">:=</span> <span class="n">model</span><span class="o">.</span><span class="n">bias</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">-</span> <span class="n">learning_rate</span> <span class="o">*</span> <span class="n">grad_bias</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>

  <span class="n">model</span>
<span class="o">;;</span>

<span class="k">let</span> <span class="n">model</span> <span class="o">=</span> <span class="nc">Linear</span> <span class="mi">1</span> <span class="mi">1</span><span class="o">;</span>

<span class="k">let</span> <span class="n">train</span> <span class="o">=</span> <span class="n">fn</span> <span class="n">model</span><span class="o">:</span> <span class="o">(</span><span class="nc">TLinear</span><span class="o">)</span> <span class="n">epochs</span> <span class="o">-&gt;</span>
  <span class="k">match</span> <span class="n">epochs</span> <span class="k">with</span>
  <span class="o">|</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">model</span>
  <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="o">(</span>
    <span class="k">let</span> <span class="n">pred</span> <span class="o">=</span> <span class="n">forward</span> <span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="n">weight</span><span class="o">,</span> <span class="n">model</span><span class="o">.</span><span class="n">bias</span><span class="o">)</span> <span class="nc">X</span><span class="o">;</span>
    <span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="n">mse_loss</span> <span class="n">pred</span> <span class="nc">Y</span><span class="o">;</span>
    <span class="k">let</span> <span class="n">m</span> <span class="o">=</span> <span class="n">sgd_optim</span> <span class="mi">0</span><span class="o">.</span><span class="mi">01</span> <span class="n">model</span> <span class="n">pred</span> <span class="nc">X</span> <span class="nc">Y</span><span class="o">;</span>
    <span class="n">train</span> <span class="n">m</span> <span class="o">(</span><span class="n">epochs</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">;;</span>

<span class="n">train</span> <span class="n">model</span> <span class="mi">100</span><span class="o">;</span>

<span class="o">#</span> <span class="nc">Optional</span> <span class="k">to</span> <span class="n">view</span> <span class="n">the</span> <span class="n">scatter</span> <span class="n">plot</span> <span class="k">of</span> <span class="n">input</span> <span class="n">data</span> <span class="n">vs</span> <span class="n">the</span> <span class="n">interpolated</span> <span class="n">line</span><span class="o">:</span>
<span class="o">#</span> <span class="nc">NB</span><span class="o">:</span> <span class="n">using</span> <span class="n">the</span> <span class="nc">Gui</span> <span class="n">library</span> <span class="n">requires</span> <span class="n">using</span> <span class="n">the</span> <span class="n">ylc</span> <span class="o">-</span><span class="n">i</span> <span class="n">option</span> <span class="k">in</span> <span class="n">order</span> <span class="k">to</span> <span class="n">keep</span>
<span class="o">#</span> <span class="n">the</span> <span class="n">parent</span> <span class="n">process</span> <span class="n">running</span> <span class="k">and</span> <span class="n">able</span> <span class="k">to</span> <span class="n">create</span> <span class="n">windows</span>

<span class="n">import</span> <span class="n">gui</span><span class="o">/</span><span class="n">bindings</span><span class="o">/</span><span class="nc">Gui</span><span class="o">;</span>

<span class="nn">Gui</span><span class="p">.</span><span class="n">create_decl_ui</span> <span class="o">(</span><span class="n">fn</span> <span class="bp">()</span> <span class="o">-&gt;</span>
  <span class="k">let</span> <span class="n">p</span> <span class="o">=</span> <span class="nn">Gui</span><span class="p">.</span><span class="nc">Plt</span> <span class="mi">0</span><span class="o">.</span> <span class="mi">11</span><span class="o">.</span> <span class="mi">0</span><span class="o">.</span> <span class="mi">30</span><span class="o">.;</span>
  <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">Gui</span><span class="p">.</span><span class="nc">Scatter</span> <span class="n">p</span> <span class="o">(</span><span class="n">array_size</span> <span class="nc">X</span><span class="o">)</span> <span class="o">(</span><span class="n">cstr</span> <span class="nc">X</span><span class="o">)</span> <span class="o">(</span><span class="n">cstr</span> <span class="nc">Y</span><span class="o">);</span>
  <span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="nn">Gui</span><span class="p">.</span><span class="nc">LinePlt</span>
    <span class="n">p</span>
    <span class="mi">2</span>
    <span class="o">([|</span><span class="mi">0</span><span class="o">.,</span> <span class="mi">11</span><span class="o">.|]</span> <span class="o">|&gt;</span> <span class="n">cstr</span><span class="o">)</span>
    <span class="o">([|</span><span class="mi">0</span><span class="o">.,</span> <span class="mi">11</span><span class="o">.|]</span> <span class="o">|&gt;</span> <span class="n">forward</span> <span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="n">weight</span><span class="o">,</span> <span class="n">model</span><span class="o">.</span><span class="n">bias</span><span class="o">)</span> <span class="o">|&gt;</span> <span class="n">cstr</span><span class="o">)</span>
    <span class="o">;</span>
<span class="o">)</span>
</code></pre></div>

<p>here's an example output plot:
<img alt="Linear Regression Plot" src="lin_reg_example_plt.png" /></p>
<p>Further example programs <a href="https://github.com/crawdaddie/yalce/tree/main/examples">here</a></p>
    </main>
    <script>
      // Add copy buttons to code blocks
      document.addEventListener('DOMContentLoaded', function() {
        const codeBlocks = document.querySelectorAll('.codehilite');

        codeBlocks.forEach(function(codeBlock) {
          const button = document.createElement('button');
          button.className = 'copy-button';
          button.setAttribute('aria-label', 'Copy code to clipboard');
          button.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg>';

          button.addEventListener('click', function() {
            const code = codeBlock.querySelector('pre').textContent;

            navigator.clipboard.writeText(code).then(function() {
              button.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path></svg>';
              button.classList.add('copied');

              setTimeout(function() {
                button.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg>';
                button.classList.remove('copied');
              }, 2000);
            }).catch(function(err) {
              console.error('Failed to copy:', err);
            });
          });

          codeBlock.style.position = 'relative';
          codeBlock.appendChild(button);
        });
      });
    </script>
  </body>
</html>
